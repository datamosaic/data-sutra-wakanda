/** * AC API * @version 1 * @modified 2014 April 14 */var AC = {	organization : new Object(),	user: new Object()};/** * Get all organizations * @public * @returns {Array} */AC.organization.getAll = function get() {	return ds.Organization.all();};/** * Delete all organizations * @returns {Boolean} */AC.organization.removeAll = function remove() {	return ds.Organization.remove();};/** * Create new user with given credentials * * @param {{name: [String], password: [String], name_first: [String], name_last: [String], flag_active: [Boolean]}}} values At least name and password are required * @param {Boolean} [active=false] Is the user active or not * @public * @returns {Entity} */AC.user.create = function createUser(values,active) {	// enough information to try and create a login	if (typeof values == 'object' && values.hasOwnProperty('name') && values.hasOwnProperty('password')) {		// check to see if this user already exists		var record = ds.User.query("name = :1",values.name).first();				if (record) {			return { 				'error': 409, 				'errorMessage': 'User already exists'			};		}				// create user record		record = ds.User.createEntity();		record.name = values.name;		record.password = directory.computeHA1(values.name, values.password);		record.name_first = values.name_first;		record.name_last = values.name_last;		// parameter in value object takes precedence		record.flag_active = values.flag_active || active;		record.save();				return record;	}}/** * Rename user * * @param {String} oldName Name of user to rename * @param {String} newName New name to give this user * @param {String} password Current password * @public * @returns {Boolean} */AC.user.rename = function renameUser(oldName,newName,oldPassword) {	if (oldName && newName) {		var password = directory.computeHA1(oldName, oldPassword);		var record = ds.User.query("name = :1 and password = :2", oldName, password).first();				if (record) {			record.name = newName;			record.password = directory.computeHA1(newName, oldPassword);			record.save();						return true;		}	}	return { 		'error': 404, 		'errorMessage': 'User not found'	};}/** * Delete user  * * @param {String} name Name of user to delete * @public * @returns {Boolean} */AC.user.remove = function deleteUser(name) {	if (name) {		var record = ds.User.query("name = :1", name).first();				if (record) {			record.remove();						return true;		}				return { 			'error': 404, 			'errorMessage': 'User not found'		};	}}/** * Toggle user active flag * * @param {String} name Name of user * @param {Boolean} status Toggle user status * @public * @returns {Boolean} */AC.user.activate = function activateUser(name,status) {	if (name && typeof status == 'boolean') {		var record = ds.User.query("name = :1", name).first();				if (record) {			record.flag_active = status;			record.save();						return true;		}				return { 			'error': 404, 			'errorMessage': 'User not found'		};	}	return { 		'error': 400, 		'errorMessage': 'Incorrect parameters passed'	};}/** * Get name of user * * @param {String} ID UUID of user * @public * @returns {String} */AC.user.getName = function getUserName(ID) {	if (ID) {		var record = ds.User.query("ID = :1", ID).first();				if (record) {			return record.name;		}				return { 			'error': 404, 			'errorMessage': 'User not found'		};	}	return { 		'error': 400, 		'errorMessage': 'Incorrect parameters passed'	};}module.exports = AC;